<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Kaifeng Lu" />

<meta name="date" content="2021-12-15" />

<title>Power Calculation Using Max-Combo Tests</title>

<script src="data:application/javascript;base64,Ly8gUGFuZG9jIDIuOSBhZGRzIGF0dHJpYnV0ZXMgb24gYm90aCBoZWFkZXIgYW5kIGRpdi4gV2UgcmVtb3ZlIHRoZSBmb3JtZXIgKHRvCi8vIGJlIGNvbXBhdGlibGUgd2l0aCB0aGUgYmVoYXZpb3Igb2YgUGFuZG9jIDwgMi44KS4KZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uKGUpIHsKICB2YXIgaHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJkaXYuc2VjdGlvbltjbGFzcyo9J2xldmVsJ10gPiA6Zmlyc3QtY2hpbGQiKTsKICB2YXIgaSwgaCwgYTsKICBmb3IgKGkgPSAwOyBpIDwgaHMubGVuZ3RoOyBpKyspIHsKICAgIGggPSBoc1tpXTsKICAgIGlmICghL15oWzEtNl0kL2kudGVzdChoLnRhZ05hbWUpKSBjb250aW51ZTsgIC8vIGl0IHNob3VsZCBiZSBhIGhlYWRlciBoMS1oNgogICAgYSA9IGguYXR0cmlidXRlczsKICAgIHdoaWxlIChhLmxlbmd0aCA+IDApIGgucmVtb3ZlQXR0cmlidXRlKGFbMF0ubmFtZSk7CiAgfQp9KTsK"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">
/* for pandoc --citeproc since 2.11 */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="data:text/css,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">Power Calculation Using Max-Combo Tests</h1>
<h4 class="author">Kaifeng Lu</h4>
<h4 class="date">12/15/2021</h4>



<p>This R Markdown document illustrates the power calculation using the maximum of weighted log-rank statistics in a group sequential analysis for the delayed effect example from <span class="citation">Prior (2020)</span>. The hazards in both arms are 0.25 per month for the first 1.5 months, and the hazard of the active arm drops to 0.125 per month thereafter, while the hazard of the placebo arm remains at 0.25 per month. Assume that there is no censoring. The enrollment rate is 25 patients per month, and the total number of patients to enroll is 100. Suppose also that an interim analysis occurs after observing 50 events and the final analysis takes place after all 100 events have been observed. The conventional log-rank test will be used for the interim analysis, and the maximum of the standardized weighted log-rank test statistics of FH(0,0) and FH(0,1) will be used at the final analysis. For a total one-sided 2.5% significance level with an interim alpha of 0.0015, <span class="citation">Prior (2020)</span> reports that the resulting power is abut 73%. We now verify this through analytic calculation and simulation.</p>
<p>First, we derive the critical values at the interim and final analyses. For the interim analysis, only one log-rank test will be used, hence the critical value is <span class="math inline">\(u_1 = \Phi^{-1}(1-0.0015) = 2.968\)</span>. For the final analysis, the critical value <span class="math inline">\(u_2\)</span> satisfies <span class="math display">\[
  P_0(W_{1,1} &lt; u_1, \max(W_{2,1}, W_{2,2}) &lt; u_2) = 1 - 0.025
\]</span> which is the same as <span class="math display">\[
  P_0(W_{1,1} &lt; u_1, W_{2,1} &lt; u_2, W_{2,2} &lt; u_2) = 0.975 \; 
    (Eq. 1)
\]</span> Let <span class="math inline">\(U_{i, FH(p,q)}\)</span> denote the numerator of the FH(p,q) weighted log-rank test statistic at analysis <span class="math inline">\(i\)</span>, and <span class="math inline">\(V_{i,FH(p,q)}\)</span> its variance. Then <span class="math inline">\(W_{i, FH(p,q)} = U_{i, FH(p,q))}/{V_{i,FH(p,q)}^{1/2}}\)</span>. In addition, similar to <span class="citation">Karrison (2016)</span>, we can show that <span class="math display">\[
  Cov(U_{1,FH(p_1,q_1)}, U_{2,FH(p_2,q_2)}) = 
  V_{1,FH\left(\frac{p_1+p_2}{2},\frac{q_1+q_2}{2}\right)}
\]</span></p>
<p>First, we find the time when 50 and 99.9 events are expected to have occurred.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lrstat)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>(<span class="at">time =</span> <span class="fu">caltime</span>(<span class="at">nevents=</span><span class="fu">c</span>(<span class="dv">50</span>, <span class="fl">99.9</span>), <span class="at">accrualIntensity=</span><span class="dv">25</span>,</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">piecewiseSurvivalTime=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">lambda1=</span><span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.125</span>), <span class="at">lambda2=</span><span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.25</span>), </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">accrualDuration=</span><span class="dv">4</span>, <span class="at">followupTime=</span><span class="dv">60</span>))</span></code></pre></div>
<pre><code>## [1]  5.362947 50.323685</code></pre>
<p>Then, we obtain the the means and variances of weighted log-rank test statistics at the interim and final analyses for relevant FH weights.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">lr00 =</span> <span class="fu">lrstat</span>(<span class="at">time=</span><span class="fu">c</span>(<span class="fl">5.363</span>, <span class="fl">50.324</span>), <span class="at">accrualIntensity=</span><span class="dv">25</span>,</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">piecewiseSurvivalTime=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">lambda1=</span><span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.125</span>), <span class="at">lambda2=</span><span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.25</span>), </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">accrualDuration=</span><span class="dv">4</span>, <span class="at">followupTime=</span><span class="dv">60</span>, </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">rho1=</span><span class="dv">0</span>, <span class="at">rho2=</span><span class="dv">0</span>, <span class="at">numSubintervals=</span><span class="dv">10000</span>))</span></code></pre></div>
<pre><code>##   stratum   time subjects  nevents nevents1 nevents2     uscore   vscore
## 1       1  5.363      100 50.00056 22.47993 27.52063  -3.178841 12.46381
## 2       1 50.324      100 99.90000 49.90030 49.99970 -10.540141 22.27099
##     logRankZ logRankHR
## 1 -0.9004164 0.7748811
## 2 -2.2334522 0.6229633</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">lr01 =</span> <span class="fu">lrstat</span>(<span class="at">time=</span><span class="fu">c</span>(<span class="fl">5.363</span>, <span class="fl">50.324</span>), <span class="at">accrualIntensity=</span><span class="dv">25</span>,</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">piecewiseSurvivalTime=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">lambda1=</span><span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.125</span>), <span class="at">lambda2=</span><span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.25</span>), </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">accrualDuration=</span><span class="dv">4</span>, <span class="at">followupTime=</span><span class="dv">60</span>, </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">rho1=</span><span class="dv">0</span>, <span class="at">rho2=</span><span class="dv">1</span>, <span class="at">numSubintervals=</span><span class="dv">10000</span>))</span></code></pre></div>
<pre><code>##   stratum   time subjects  nevents nevents1 nevents2    uscore   vscore
## 1       1  5.363      100 50.00056 22.47993 27.52063 -1.385076 1.163733
## 2       1 50.324      100 99.90000 49.90030 49.99970 -6.603753 6.157843
##    logRankZ logRankHR
## 1 -1.283947 0.3041601
## 2 -2.661194 0.3421817</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">lr0h =</span> <span class="fu">lrstat</span>(<span class="at">time=</span><span class="fu">c</span>(<span class="fl">5.363</span>, <span class="fl">50.324</span>), <span class="at">accrualIntensity=</span><span class="dv">25</span>,</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">piecewiseSurvivalTime=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">lambda1=</span><span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.125</span>), <span class="at">lambda2=</span><span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.25</span>), </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">accrualDuration=</span><span class="dv">4</span>, <span class="at">followupTime=</span><span class="dv">60</span>, </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">rho1=</span><span class="dv">0</span>, <span class="at">rho2=</span><span class="fl">0.5</span>, <span class="at">numSubintervals=</span><span class="dv">10000</span>))</span></code></pre></div>
<pre><code>##   stratum   time subjects  nevents nevents1 nevents2    uscore    vscore
## 1       1  5.363      100 50.00056 22.47993 27.52063 -2.088892  3.240573
## 2       1 50.324      100 99.90000 49.90030 49.99970 -8.249114 10.076782
##    logRankZ logRankHR
## 1 -1.160393 0.5248695
## 2 -2.598642 0.4410373</code></pre>
<p>It follows that the mean of <span class="math inline">\(\mathbf{W}=(W_{1,1}, W_{2,1}, W_{2,2})\)</span> is <span class="math display">\[
  \left(\frac{3.179}{\sqrt{12.464}}, \frac{10.540}{\sqrt{22.271}}, 
  \frac{6.604}{\sqrt{6.158}} \right) = (0.900, 2.233, 2.661)
\]</span> and the covariance matrix of <span class="math inline">\(\mathbf{W}\)</span> is <span class="math display">\[
  \left(\begin{array}{ccc} 1 &amp; \sqrt{\frac{12.464}{22.271}} &amp; \frac{3.241}{\sqrt{12.464\times 6.158}} \\
  \sqrt{\frac{12.464}{22.271}} &amp; 1 &amp; \frac{10.077}{\sqrt{22.271\times 6.158}} \\ 
  \frac{3.241}{\sqrt{12.464\times 6.158}}  &amp; \frac{10.077}{\sqrt{22.271\times 6.158}} &amp; 1 \end{array} \right) = \left(\begin{array}{ccc} 1 &amp; 0.748 &amp;  0.370 \\ 
  0.748 &amp; 1 &amp; 0.860 \\ 0.370 &amp; 0.860 &amp; 1 \end{array} \right)
\]</span> Now, we obtain the critical value <span class="math inline">\(u_2\)</span> by solving equation (1).</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mvtnorm)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">0.900</span>, <span class="fl">2.233</span>, <span class="fl">2.661</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.748</span>, <span class="fl">0.370</span>, <span class="fl">0.748</span>, <span class="dv">1</span>, <span class="fl">0.860</span>, <span class="fl">0.370</span>, <span class="fl">0.860</span>, <span class="dv">1</span>), <span class="dv">3</span>, <span class="dv">3</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>u1 <span class="ot">=</span> <span class="fl">2.968</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">=</span> <span class="fl">0.025</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(u2, u1, sigma, alpha) {</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pmvnorm</span>(<span class="at">upper=</span><span class="fu">c</span>(u1, u2, u2), <span class="at">corr=</span>sigma) <span class="sc">-</span> alpha</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>(<span class="at">u2 =</span> <span class="fu">uniroot</span>(f, <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>), u1, sigma, alpha)<span class="sc">$</span>root)</span></code></pre></div>
<pre><code>## [1] 2.136087</code></pre>
<p>The power can be estimated by plugging in the mean under the alternative hypothesis.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">-</span> <span class="fu">pmvnorm</span>(<span class="at">upper=</span><span class="fu">c</span>(u1, u2, u2), <span class="at">corr=</span>sigma, <span class="at">mean=</span>mu)</span></code></pre></div>
<pre><code>## [1] 0.7245565
## attr(,&quot;error&quot;)
## [1] 0.0001708464
## attr(,&quot;msg&quot;)
## [1] &quot;Normal Completion&quot;</code></pre>
<p>For the simulation study, we use infinite critical values for the FH(0,0) and FH(0,1) log-rank statistics at the interim and final analyses for each iteration, and then construct the maximum combo test statistic at the final analysis. Finally, we tally the rejections across iterations to estimate the power. The same seed should be used to produce identical simulated data.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>sim1 <span class="ot">=</span> <span class="fu">lrsim</span>(<span class="at">kMax =</span> <span class="dv">2</span>, <span class="at">informationTime =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">1</span>),</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">criticalValues =</span> <span class="fu">c</span>(<span class="cn">Inf</span>, <span class="cn">Inf</span>),</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">accrualIntensity =</span> <span class="dv">25</span>, <span class="at">accrualDuration =</span> <span class="dv">4</span>,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">piecewiseSurvivalTime =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">lambda1 =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.125</span>), <span class="at">lambda2 =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.25</span>),</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">rho1 =</span> <span class="dv">0</span>, <span class="at">rho2 =</span> <span class="dv">0</span>,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">plannedEvents =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">100</span>), </span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">maxNumberOfIterations =</span> <span class="dv">1000</span>,</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">seed =</span> <span class="dv">314159</span>)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>sim2 <span class="ot">=</span> <span class="fu">lrsim</span>(<span class="at">kMax =</span> <span class="dv">2</span>, <span class="at">informationTime =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">1</span>),</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">criticalValues =</span> <span class="fu">c</span>(<span class="cn">Inf</span>, <span class="cn">Inf</span>),</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">accrualIntensity =</span> <span class="dv">25</span>,</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">piecewiseSurvivalTime =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>             <span class="at">lambda1 =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.125</span>), <span class="at">lambda2 =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.25</span>),</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>             <span class="at">accrualDuration =</span> <span class="dv">4</span>,</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">rho1 =</span> <span class="dv">0</span>, <span class="at">rho2 =</span> <span class="dv">1</span>, </span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>             <span class="at">plannedEvents =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">100</span>),</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>             <span class="at">maxNumberOfIterations =</span> <span class="dv">1000</span>,</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>             <span class="at">seed =</span> <span class="dv">314159</span>)</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>w1max <span class="ot">=</span> <span class="fu">subset</span>(<span class="sc">-</span>sim1<span class="sc">$</span>sumdata<span class="sc">$</span>logRankStatistic, sim1<span class="sc">$</span>sumdata<span class="sc">$</span>stageNumber<span class="sc">==</span><span class="dv">1</span>)</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>w2max <span class="ot">=</span> <span class="fu">pmax</span>(<span class="sc">-</span>sim1<span class="sc">$</span>sumdata<span class="sc">$</span>logRankStatistic, <span class="sc">-</span>sim2<span class="sc">$</span>sumdata<span class="sc">$</span>logRankStatistic) </span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>w2max <span class="ot">=</span> <span class="fu">subset</span>(w2max, sim1<span class="sc">$</span>sumdata<span class="sc">$</span>stageNumber<span class="sc">==</span><span class="dv">2</span>)</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>((w1max <span class="sc">&gt;</span> u1) <span class="sc">|</span> (w2max <span class="sc">&gt;</span> u2))</span></code></pre></div>
<pre><code>## [1] 0.723</code></pre>
<p>Both the analytic and simulation methods yield a power of about 72%, close to that reported by <span class="citation">Prior (2020)</span>.</p>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-karrison2016" class="csl-entry">
Karrison, Theodore G. 2016. <span>“Versatile Tests for Comparing Survival Curves Based on Weighted Log-Rank Statistics.”</span> <em>The Stata Journal: Promoting Communications on Statistics and Stata</em> 16 (3): 678–90. <a href="https://doi.org/10.1177/1536867x1601600308">https://doi.org/10.1177/1536867x1601600308</a>.
</div>
<div id="ref-prior2020" class="csl-entry">
Prior, Thomas J. 2020. <span>“Group Sequential Monitoring Based on the Maximum of Weighted Log-Rank Statistics with the Fleming<span></span>Harrington Class of Weights in Oncology Clinical Trials.”</span> <em>Statistical Methods in Medical Research</em> 29 (12): 3525–32. <a href="https://doi.org/10.1177/0962280220931560">https://doi.org/10.1177/0962280220931560</a>.
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
